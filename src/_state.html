<%
  const senateData = require("../data/senate.json");
  const stateData = require("../build/data/states/" + key + ".json");

  const offices = {
  	"governor": "G",
  	"senate": "S",
  	"house": "H",
  	"ballot-measures": "I"
  }

  let sections = ["key-races", "president"];
  let keyRaces = ["president"];

  if (stateData.results.filter(d => d.office === "G").length > 0) {
  	sections.push("governor");
  }
  if (stateData.results.filter(d => d.office === "S").length > 0) {
  	sections.push("senate");
  	keyRaces.push("senate");
  }
  if (key != "DC") {
  	sections.push("house");
  }
  if (stateData.results.filter(d => d.office === "I").length > 0) {
  	sections.push("ballot-measures");
  }

  
%>

<!doctype html>
<html lang="en-US">
  <head>
    <%= t.include("partials/_head.html", grunt.data.json) %>
    <link rel="stylesheet" type="text/css" href="state.css">
  </head>
  <body>
    <%= t.include("partials/_statePageHeader.html", {state: key, sections: sections}) %>
    <main class="app constrained">
    	<% sections.forEach(section => { %>
    		<section id='<%= section %>-section'>
    			<% if (section === "key-races") { %>
    				key races here
    			<% } else { %>
	    			<results-collection state="<%= key %>" office="<%= offices[section] %>"></results-collection>
    			<% } %>
    		</section>
    	<% }); %>
    </main>
    <script>
      window.PROJECT_ANALYTICS = <%= JSON.stringify(grunt.data.json.project.analytics || {}) %>;
    </script>
    <script src="state.js" async></script>
    <%= t.include("partials/_analytics.html") %>
  </body>
</html>
